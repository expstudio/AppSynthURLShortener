<div class="sendMessage" >
    <div class="container">
        <div class="row">
            <div ng-include="'../../common/views/appHeader.html'"></div>
        </div>

        <div class="content">
            <h3 class="title">{{'COMPOSE_MESSAGE' | translate}}</h3>
            <div ng-include=" 'composeMessageTpl.html' "></div>
        </div>
    </div>

</div>
<script type="text/ng-template" id="composeMessageTpl.html">
    <form ng-controller="sendMessageController" name="sendMessageForm" novalidate
          ng-submit="sendMessage(sendMessageForm.$valid, message.draft)">
        <div class="form-group" ng-show="identity.isAuthorized('teacher')">
            <div class="recipientInput" class="">
                <ul>
                    <li ng-repeat="receiver in chosenReceivers">
                        <i class="fa fa-times" ng-click="toggleRemovePicked($index)"></i>
                        {{receiver.name}}
                    </li>
                    <li class="input" ng-focus="true">
                        <input type="text" class="" ng-init="isOn = false" ng-click="isOn = !isOn" name="recipients" placeholder="{{'ADD_RECIPIENTS' | translate}}" ng-model="message.receiverFilter"/>
                    </li>
                </ul>
            </div>
            <span class="messageReceiver" ng-show="isOn">
                <span ng-click="isOn = false" class="closeBtn">X</span>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" ng-model="chooseAll" ng-change="toggleAllPicked()"/>
                        {{'SELECT_ALL' | translate}}
                    </label>
                </div>
                <ul class="recipientList">
                    <li class="recipient" ng-repeat="student in unchosenReceivers | filter: message.receiverFilter"
                        ng-click="togglePicked($index)">
                        <i class="fa fa-user"></i>
                        <h5>{{student.name}}</h5>
                    </li>
                </ul>
            </span>
        </div>

        <div class="form-group">

            <div class="btn-group template" dropdown>
                <div class="input-group">
                    <input type="text" class="form-control" name="title" placeholder="{{'CHOOSE_TEMPLATE' | translate}}" ng-model="message.title"/>

                    <div class="dropdown-toggle input-group-addon" dropdown-toggle>
                        <span class="caret"></span>
                        <span class="sr-only">Split button!</span>
                    </div>
                </div>
                <ul class="dropdown-menu" role="menu">
                    <li ng-if="templates.length === 0" class="no-template">
                        <p class="text-center">{{"You don't have any template" | translate}}</p>
                    </li>
                    <li ng-repeat="template in templates" class="template">
                        <a href="#" ng-click="applyTemplate($index)">{{template.title}}</a>
                        <span class="delete" ng-click="deleteTemplate(template)"><i class="fa fa-trash"></i></span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="form-group">
            <textarea name="body" id="messageBodyDesktop" ng-if="!isMobile" class="form-control" ckeditor="editorOptions" ng-model="message.body"></textarea>
            <textarea name="body" id="messageBodyMobile" ng-if= "isMobile" class="form-control" ckeditor="mobileEditor" ng-model="message.body"></textarea>
            <!--<textarea name="body" id="messageBodyMobile" class="form-control" rows="7" ng-model="message.body"></textarea>-->
        </div>
        <div class="actions text-right">
            <!--<a href="#" class="printer pull-left" ng-click="printCurrentPage()"><i class="fa fa-print"></i></a>-->
            <!--<button type="button" class="btn btn-success pull-left" ng-print print-element-id="cke_1_contents"><i class="fa fa-print"></i> Print</button>-->
            <button type="button" class="btn btn-info" ng-click="saveTemplate(message)">{{'Save template' | translate}}</button>
            <button type="submit" class="btn btn-info" ng-click="message.draft=true">{{'SAVE_DRAFT' | translate}}</button>
            <button type="button" class="btn btn-danger" ng-click="cancelMessage()">{{'CANCEL' | translate}}</button>
            <button type="submit" class="btn btn-success submit" ng-click="message.draft=false">{{'SEND' | translate}}</button>
        </div>
    </form>
</script>
